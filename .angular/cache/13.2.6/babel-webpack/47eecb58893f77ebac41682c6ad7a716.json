{"ast":null,"code":"import { Order } from '../model/Order.model';\nimport { Payment } from '../model/Payment.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/payment.service\";\nimport * as i2 from \"../services/order.service\";\nimport * as i3 from \"../services/caddy.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/forms\";\n\nfunction PaymentComponent_div_0_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 3)(1, \"form\", 4, 5);\n    i0.ɵɵlistener(\"ngSubmit\", function PaymentComponent_div_0_div_3_Template_form_ngSubmit_1_listener() {\n      i0.ɵɵrestoreView(_r5);\n\n      const _r3 = i0.ɵɵreference(2);\n\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return ctx_r4.onConfirmPayOrder(_r3.value);\n    });\n    i0.ɵɵelementStart(3, \"div\", 6)(4, \"label\", 7);\n    i0.ɵɵtext(5, \"Type Carte:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"select\", 8)(7, \"option\", 9);\n    i0.ɵɵtext(8, \"VISA\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"option\", 10);\n    i0.ɵɵtext(10, \"Master Card\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(11, \"div\", 6)(12, \"label\", 7);\n    i0.ɵɵtext(13, \"Num\\u00E9ro Carte:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(14, \"input\", 11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"div\", 6)(16, \"label\", 7);\n    i0.ɵɵtext(17, \"Code v\\u00E9rification:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(18, \"input\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"div\", 6)(20, \"label\", 7);\n    i0.ɵɵtext(21, \"Montant total:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"input\", 13);\n    i0.ɵɵlistener(\"ngModelChange\", function PaymentComponent_div_0_div_3_Template_input_ngModelChange_22_listener($event) {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return ctx_r6.associatedOrder.totalAmount = $event;\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(23, \"input\", 14);\n    i0.ɵɵlistener(\"ngModelChange\", function PaymentComponent_div_0_div_3_Template_input_ngModelChange_23_listener($event) {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return ctx_r7.orderId = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(24, \"input\", 15);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(22);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.associatedOrder.totalAmount);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.orderId);\n  }\n}\n\nfunction PaymentComponent_div_0_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 3);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.confirmationMsg, \" \");\n  }\n}\n\nfunction PaymentComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 1);\n    i0.ɵɵtext(2, \" Informations Paiement \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, PaymentComponent_div_0_div_3_Template, 25, 2, \"div\", 2);\n    i0.ɵɵtemplate(4, PaymentComponent_div_0_div_4_Template, 2, 1, \"div\", 2);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵclassMapInterpolate1(\"panel \", ctx_r0.panelStyle, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.viewMode == 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.viewMode == 1);\n  }\n}\n\nexport let PaymentComponent = /*#__PURE__*/(() => {\n  class PaymentComponent {\n    constructor(paymentService, orderService, caddyService, activatedRoute) {\n      this.paymentService = paymentService;\n      this.orderService = orderService;\n      this.caddyService = caddyService;\n      this.activatedRoute = activatedRoute;\n      this._panelStyle = 'panel-default';\n      this._confirmationMsg = \"\";\n      this._viewMode = 0;\n    }\n\n    ngOnInit() {\n      // recup orderId passe ds url\n      this._orderId = this.activatedRoute.snapshot.params['orderId']; // recup l'Ordre correspond a orderId\n\n      this.orderService.getOrder(this._orderId).subscribe(response => {\n        this._associatedOrder = response;\n        console.log(\"this._associatedOrder\");\n        console.log(this._associatedOrder);\n      }, err => {\n        console.log(err);\n      });\n    }\n\n    onConfirmPayOrder(paymentFormFields) {\n      // console.log(\"paymentFormFields\");\n      // console.log(paymentFormFields);\n      this.paymentService.payment = new Payment();\n      this.paymentService.payment.datePayment = new Date();\n      this.paymentService.payment.cardType = paymentFormFields.cardType;\n      this.paymentService.payment.cardNumber = paymentFormFields.cardNumber;\n      this.paymentService.payment.order = new Order();\n      this.paymentService.payment.order.id = paymentFormFields.orderId; // envoyer le payment pr le sauvegarder ds la BD \n\n      this.paymentService.savePayment(this.paymentService.payment).subscribe(response => {\n        // afficher un msg de confirmation avec la reference du paiement renvoyee par le backend\n        this._confirmationMsg = \"Paiement effectué avec succès suos la référence: \" + response.referencePayment + \"\";\n        this._panelStyle = \"panel-success\"; // pr l affichage du message de confirmation\n\n        this._viewMode = 1; // vider le caddy courant après avoir effectuer le paiement\n\n        this.caddyService.emptyCurrentCaddy();\n      }, err => {\n        this._confirmationMsg = \"Erreur de Paiement, veuillez ressayer ultérieurement.\";\n        this._panelStyle = \"panel-danger\"; // pr l affichage du message d erreur\n\n        this._viewMode = 1;\n        console.log(err);\n      });\n    }\n\n    get orderId() {\n      return this._orderId;\n    }\n\n    set orderId(value) {\n      this._orderId = value;\n    }\n\n    get panelStyle() {\n      return this._panelStyle;\n    }\n\n    set panelStyle(value) {\n      this._panelStyle = value;\n    }\n\n    get associatedOrder() {\n      return this._associatedOrder;\n    }\n\n    set associatedOrder(value) {\n      this._associatedOrder = value;\n    }\n\n    get confirmationMsg() {\n      return this._confirmationMsg;\n    }\n\n    set confirmationMsg(value) {\n      this._confirmationMsg = value;\n    }\n\n    get viewMode() {\n      return this._viewMode;\n    }\n\n    set viewMode(value) {\n      this._viewMode = value;\n    }\n\n  }\n\n  PaymentComponent.ɵfac = function PaymentComponent_Factory(t) {\n    return new (t || PaymentComponent)(i0.ɵɵdirectiveInject(i1.PaymentService), i0.ɵɵdirectiveInject(i2.OrderService), i0.ɵɵdirectiveInject(i3.CaddyService), i0.ɵɵdirectiveInject(i4.ActivatedRoute));\n  };\n\n  PaymentComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: PaymentComponent,\n    selectors: [[\"app-payment\"]],\n    decls: 1,\n    vars: 1,\n    consts: [[3, \"class\", 4, \"ngIf\"], [1, \"panel-heading\"], [\"class\", \"panel-body\", 4, \"ngIf\"], [1, \"panel-body\"], [3, \"ngSubmit\"], [\"formPayment\", \"ngForm\"], [1, \"form-group\"], [1, \"control-label\"], [\"name\", \"cardType\", \"ngModel\", \"\", 1, \"form-control\"], [\"value\", \"visa\"], [\"value\", \"masterCard\"], [\"type\", \"text\", \"name\", \"cardNumber\", \"ngModel\", \"\", 1, \"form-control\"], [\"type\", \"text\", \"name\", \"verifCode\", \"ngModel\", \"\", 1, \"form-control\"], [\"type\", \"text\", \"disabled\", \"\", \"name\", \"totalAmount\", \"ngModel\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"hidden\", \"name\", \"orderId\", \"ngModel\", \"\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"submit\", \"value\", \"Confirmer Paiement\", 1, \"btn\", \"btn-success\"]],\n    template: function PaymentComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, PaymentComponent_div_0_Template, 5, 5, \"div\", 0);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.associatedOrder);\n      }\n    },\n    directives: [i5.NgIf, i6.ɵNgNoValidate, i6.NgControlStatusGroup, i6.NgForm, i6.SelectControlValueAccessor, i6.NgControlStatus, i6.NgModel, i6.NgSelectOption, i6.ɵNgSelectMultipleOption, i6.DefaultValueAccessor],\n    styles: [\"\"]\n  });\n  return PaymentComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}